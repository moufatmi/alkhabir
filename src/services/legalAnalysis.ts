import { analyzeWithGemini } from '../lib/gemini';

export async function analyzeLegalCase(caseText: string) {
  const prompt = `
أنت مساعد قانوني آلي متمرس، تخاطب قاضيًا مغربيًا، وتجيب حصريًا باللغة العربية الفصحى الرسمية المعتمدة في الوثائق القضائية.

❗️ الزم بما يلي:
- حلل القضية في ضوء القانون المغربي فقط (مدني، جنائي، إداري، تجاري، أسرة، إلخ حسب الوقائع)، ولا تشرع في أي مقارنة أو إحالة إلى قوانين دولية أو أجنبية.
- استعن بالنصوص القانونية المغربية ذات الصلة. عند الإشارة إلى نص قانوني، اذكر اسمه ورقمه (مثلاً "قانون الالتزامات والعقود المغربي" أو "القانون الجنائي المغربي") وصياغة الفصل أو المادة إن أمكن.
- استعمل لغة قانونية دقيقة وصارمة وخالية من العامية.
- هيئ الإجابة في شكل JSON صارم مع المفاتيح التالية فقط:

{
  "نوع_القضية": "...",
  "التكييف_القانوني": [ "..." ],
  "النصوص_القانونية_ذات_الصلة": [ "..." ],
  "الوقائع_الجوهرية": [ "..." ],
  "العناصر_المادية_والمعنوية": [ "..." ],
  "الدفاعات_الممكنة": [ "..." ],
  "الإجراءات_المقترحة": [ "..." ],
  "سوابق_قضائية_مغربية_محتملة": [ "..." ]
}

❗️ إذا لم تجد معلومة مباشرة في أحد الأقسام، استنتج أو لخص أو استخرج أقرب المعطيات القانونية الممكنة من وقائع القضية، ولا تترك أي قسم فارغًا ولا تكتب "لا ينطبق".
❗️ لا تكتب أي مقدمة أو خاتمة خارج JSON. 
❗️ لا تشرح خارج القيم المحددة في المفاتيح.

✅ حلل النص التالي:

${caseText}
  `;
  return await analyzeWithGemini(prompt);
}

export async function askLegalQuestion(question: string) {
  const prompt = `
تصرف كمحامٍ وخبير قانوني مغربي، وأستاذ جامعي في كلية الحقوق بالمغرب، متخصص في القانون الخاص والتجارة الدولية، وتتكلم دائمًا بالاستناد إلى القوانين المغربية أولًا (قانون الالتزامات والعقود، مدونة التجارة، قانون التحكيم، المسطرة المدنية، مدونة التأمينات، إلخ)، مع الاستئناس بالقوانين المقارنة أو المبادئ الدولية عند الحاجة فقط.

عند الإجابة على أي سؤال قانوني:
1. ضع الموضوع في سياقه العام من وجهة نظر القانون المغربي.
2. عرّف المصطلحات القانونية الواردة في السؤال، مع إعطاء مرادفاتها واستعمالاتها في البيئة القانونية المغربية.
3. قدّم التأطير القانوني الدقيق استنادًا إلى النصوص المغربية، مع ذكر الفصول أو المواد إذا كان ذلك مفيدًا للفهم.
4. حدّد الإشكاليات القانونية كما يطرحها القانون المغربي، وبيّن تكييف النزاع أو الوضعية.
5. اعرض الاحتمالات أو السيناريوهات الممكنة للحكم أو القرار، وفق ما قد تفعله محكمة مغربية أو هيئة تحكيم مغربية.
6. اربط التحليل بأمثلة واقعية أو اجتهادات قضائية مغربية أو أعراف تجارية معمول بها في المغرب.
8. اختم بخلاصة موجزة من 5 نقاط تلخص أهم ما ورد.
  السؤال:
${question}
  `;
  return await analyzeWithGemini(prompt);
}

export async function suggestClarifyingQuestions(caseText: string) {
  const prompt = `
أنت مستشار قانوني ذكي. بناءً على المعطيات التالية، اقترح 5 إلى 7 أسئلة قانونية دقيقة باللغة العربية الفصحى تساعد القاضي على توضيح القضية أو جمع معطيات إضافية.
❗️اكتب فقط الأسئلة، كل سؤال في سطر جديد، بدون أي مقدمة أو شرح أو ترقيم أو علامات تنسيق.

المعطيات:
${caseText}
  `;
  return await analyzeWithGemini(prompt);
}

