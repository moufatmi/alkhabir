import { analyzeWithGemini } from '../lib/gemini';

export async function analyzeLegalCase(caseText: string) {
  const prompt = `
أنت مساعد قانوني آلي متمرس، تخاطب قاضيًا مغربيًا، وتجيب حصريًا باللغة العربية الفصحى الرسمية المعتمدة في الوثائق القضائية.

❗️ الزم بما يلي:
- حلل القضية في ضوء القانون المغربي فقط (مدني، جنائي، إداري، تجاري، أسرة، إلخ حسب الوقائع)، ولا تشرع في أي مقارنة أو إحالة إلى قوانين دولية أو أجنبية.
- استعن بالنصوص القانونية المغربية ذات الصلة. عند الإشارة إلى نص قانوني، اذكر اسمه ورقمه (مثلاً "قانون الالتزامات والعقود المغربي" أو "القانون الجنائي المغربي") وصياغة الفصل أو المادة إن أمكن.
- استعمل لغة قانونية دقيقة وصارمة وخالية من العامية.
- هيئ الإجابة في شكل JSON صارم مع المفاتيح التالية فقط:

{
  "التكييف_القانوني": [ "..." ],
  "النصوص_القانونية_ذات_الصلة": [ "..." ],
  "الوقائع_الجوهرية": [ "..." ],
  "العناصر_المادية_والمعنوية": [ "..." ],
  "الدفاعات_الممكنة": [ "..." ],
  "الإجراءات_المقترحة": [ "..." ],
  "سوابق_قضائية_مغربية_محتملة": [ "..." ]
}

❗️ إذا لم تجد معلومة مباشرة في أحد الأقسام، استنتج أو لخص أو استخرج أقرب المعطيات القانونية الممكنة من وقائع القضية، ولا تترك أي قسم فارغًا ولا تكتب "لا ينطبق".
❗️ لا تكتب أي مقدمة أو خاتمة خارج JSON. 
❗️ لا تشرح خارج القيم المحددة في المفاتيح.

✅ حلل النص التالي:

${caseText}
  `;
  return await analyzeWithGemini(prompt);
}

export async function askLegalQuestion(question: string) {
  const prompt = `
أنت مستشار قانوني محترف. أجب عن السؤال التالي بصيغة قانونية رسمية، مع الاستناد إلى القانون المغربي فقط، وبالعربية الفصحى:
السؤال:
${question}
  `;
  return await analyzeWithGemini(prompt);
}

